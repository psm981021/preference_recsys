
 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 38/43 [00:01<00:00, 16.67it/s]
Train UPTRec
[Train] Preparing Clustering:
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:02<00:00, 20.92it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:05<00:00,  5.02s/it]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]
Model Training
rec dataset length: 43





 86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                          | 37/43 [00:10<00:01,  3.87it/s]
{'epoch': 0, 'rec_avg_loss': '6.79873', 'NMI_cluster_reassignment': '0.000000'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:12<00:00,  3.54it/s]
 19%|███████████████████████████████████▌                                                                                                                                                           | 8/43 [00:00<00:01, 21.38it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:02<00:00, 20.84it/s]
  0%|                                                                                                                                                                                                        | 0/1 [00:00<?, ?it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:04<00:00,  4.76s/it]

 44%|███████████████████████████████████████████████████████████████████████████████████▉                                                                                                          | 19/43 [00:03<00:04,  5.51it/s][34m[1mwandb[39m[22m: [33mWARNING[39m Step only supports monotonically increasing values, use define_metric to set a custom x axis. For details see: https://wandb.me/define-metric
[34m[1mwandb[39m[22m: [33mWARNING[39m (User provided step: 0 is less than current step: 1. Dropping entry: {'NMI_cluster_reassignment': 0.0, '_timestamp': 1714899661.8736775}).


100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:07<00:00,  5.48it/s]
{'Epoch': 0, 'HIT@5': '0.000454', 'NDCG@5': '0.000276', 'HIT@10': '0.000908', 'NDCG@10': '0.000420', 'HIT@15': '0.001226', 'NDCG@15': '0.000504', 'HIT@20': '0.001635', 'NDCG@20': '0.000600'}
Validation score increased.  Saving model ...
Model Training
rec dataset length: 43
Performing Rec model Training (UPTRec):




 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                               | 36/43 [00:09<00:01,  3.90it/s]
{'epoch': 1, 'rec_avg_loss': '5.74923', 'NMI_cluster_reassignment': '0.000000'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:11<00:00,  3.85it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]




100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:08<00:00,  5.47it/s]
{'Epoch': 1, 'HIT@5': '0.000273', 'NDCG@5': '0.000134', 'HIT@10': '0.000818', 'NDCG@10': '0.000301', 'HIT@15': '0.001408', 'NDCG@15': '0.000458', 'HIT@20': '0.001681', 'NDCG@20': '0.000523'}
EarlyStopping counter: 1 out of 500
Model Training
rec dataset length: 43
  0%|                                                                                                                                                                                                       | 0/43 [00:10<?, ?it/s]
 16%|███████████████████████████████                                                                                                                                                                | 7/43 [00:01<00:09,  3.92it/s][34m[1mwandb[39m[22m: [33mWARNING[39m (User provided step: 0 is less than current step: 2. Dropping entry: {'NMI_cluster_reassignment': 0.0, '_timestamp': 1714899690.1978233}).



 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                 | 39/43 [00:09<00:01,  3.85it/s]
{'epoch': 2, 'rec_avg_loss': '4.78868', 'NMI_cluster_reassignment': '0.000000'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:10<00:00,  3.95it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]


 74%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                | 32/43 [00:05<00:02,  5.45it/s]

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:08<00:00,  5.45it/s]
{'Epoch': 2, 'HIT@5': '0.000273', 'NDCG@5': '0.000123', 'HIT@10': '0.001136', 'NDCG@10': '0.000398', 'HIT@15': '0.001590', 'NDCG@15': '0.000519', 'HIT@20': '0.001953', 'NDCG@20': '0.000605'}
Validation score increased.  Saving model ...
Model Training
rec dataset length: 43
  0%|                                                                                                                                                                                                       | 0/43 [00:10<?, ?it/s]





 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏        | 41/43 [00:10<00:00,  3.90it/s]
{'epoch': 3, 'rec_avg_loss': '4.06175', 'NMI_cluster_reassignment': '0.000000'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:11<00:00,  3.85it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]




100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:08<00:00,  5.35it/s]
{'Epoch': 3, 'HIT@5': '0.000045', 'NDCG@5': '0.000023', 'HIT@10': '0.001226', 'NDCG@10': '0.000405', 'HIT@15': '0.001862', 'NDCG@15': '0.000573', 'HIT@20': '0.002226', 'NDCG@20': '0.000659'}
Validation score increased.  Saving model ...
Model Training
rec dataset length: 43
  0%|                                                                                                                                                                                                       | 0/43 [00:10<?, ?it/s]

 33%|█████████████████████████████████████████████████████████████▊                                                                                                                                | 14/43 [00:03<00:07,  3.79it/s][34m[1mwandb[39m[22m: [33mWARNING[39m (User provided step: 0 is less than current step: 4. Dropping entry: {'NMI_cluster_reassignment': 0.0, '_timestamp': 1714899732.8968806}).



 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏        | 41/43 [00:10<00:00,  3.69it/s]
{'epoch': 4, 'rec_avg_loss': '3.50733', 'NMI_cluster_reassignment': '0.000000'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:11<00:00,  3.74it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]


 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 38/43 [00:07<00:00,  5.38it/s]

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:08<00:00,  5.37it/s]
{'Epoch': 4, 'HIT@5': '0.001136', 'NDCG@5': '0.000550', 'HIT@10': '0.001317', 'NDCG@10': '0.000610', 'HIT@15': '0.001771', 'NDCG@15': '0.000732', 'HIT@20': '0.002271', 'NDCG@20': '0.000849'}
Validation score increased.  Saving model ...
  0%|                                                                                                                                                                                                       | 0/43 [00:10<?, ?it/s]
 56%|██████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                    | 24/43 [00:01<00:00, 19.62it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:01<00:00, 21.79it/s]
  0%|                                                                                                                                                                                                        | 0/1 [00:00<?, ?it/s]
Model Training
rec dataset length: 43
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:04<00:00,  4.70s/it]





 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                 | 39/43 [00:10<00:01,  3.39it/s]
{'epoch': 5, 'rec_avg_loss': '3.04512', 'NMI_cluster_reassignment': '0.425896'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:11<00:00,  3.78it/s]
 47%|████████████████████████████████████████████████████████████████████████████████████████▎                                                                                                     | 20/43 [00:00<00:00, 23.17it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:01<00:00, 21.64it/s]
  0%|                                                                                                                                                                                                        | 0/1 [00:00<?, ?it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:04<00:00,  4.72s/it]
 19%|███████████████████████████████████▌                                                                                                                                                           | 8/43 [00:01<00:06,  5.24it/s][34m[1mwandb[39m[22m: [33mWARNING[39m (User provided step: 1 is less than current step: 6. Dropping entry: {'NMI_cluster_reassignment': 0.4258960783481598, '_timestamp': 1714899783.8842437}).




100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:08<00:00,  5.22it/s]
{'Epoch': 5, 'HIT@5': '0.001226', 'NDCG@5': '0.000738', 'HIT@10': '0.001453', 'NDCG@10': '0.000814', 'HIT@15': '0.001681', 'NDCG@15': '0.000874', 'HIT@20': '0.001999', 'NDCG@20': '0.000950'}
Validation score increased.  Saving model ...
Model Training
rec dataset length: 43
Performing Rec model Training (UPTRec):




 86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                          | 37/43 [00:09<00:01,  4.01it/s]
{'epoch': 6, 'rec_avg_loss': '2.69961', 'NMI_cluster_reassignment': '0.000000'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:11<00:00,  3.86it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]




[34m[1mwandb[39m[22m: [33mWARNING[39m (User provided step: 1 is less than current step: 7. Dropping entry: {'NMI_cluster_reassignment': 0.0, '_timestamp': 1714899812.4747443}).██████████████████████████████████████████| 43/43 [00:08<00:00,  5.37it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:10<?, ?it/s]
  2%|████▍                                                                                                                                                                                          | 1/43 [00:00<00:09,  4.53it/s]
{'Epoch': 6, 'HIT@5': '0.001317', 'NDCG@5': '0.000803', 'HIT@10': '0.001499', 'NDCG@10': '0.000860', 'HIT@15': '0.002089', 'NDCG@15': '0.001014', 'HIT@20': '0.002453', 'NDCG@20': '0.001099'}
Validation score increased.  Saving model ...
Model Training
rec dataset length: 43




100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:09<00:00,  4.34it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]
  5%|████████▉                                                                                                                                                                                      | 2/43 [00:00<00:07,  5.42it/s]
{'epoch': 7, 'rec_avg_loss': '2.38844', 'NMI_cluster_reassignment': '0.000000'}


 56%|██████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                    | 24/43 [00:04<00:03,  5.29it/s]

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:08<00:00,  5.22it/s]
{'Epoch': 7, 'HIT@5': '0.001408', 'NDCG@5': '0.000903', 'HIT@10': '0.001544', 'NDCG@10': '0.000947', 'HIT@15': '0.001953', 'NDCG@15': '0.001054', 'HIT@20': '0.002271', 'NDCG@20': '0.001129'}
Validation score increased.  Saving model ...
Model Training
rec dataset length: 43
  0%|                                                                                                                                                                                                       | 0/43 [00:10<?, ?it/s]




 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌    | 42/43 [00:09<00:00,  4.31it/s]
{'epoch': 8, 'rec_avg_loss': '2.14108', 'NMI_cluster_reassignment': '0.000000'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:10<00:00,  4.27it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]




100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:08<00:00,  5.32it/s]
{'Epoch': 8, 'HIT@5': '0.001499', 'NDCG@5': '0.000920', 'HIT@10': '0.002044', 'NDCG@10': '0.001097', 'HIT@15': '0.002316', 'NDCG@15': '0.001167', 'HIT@20': '0.002862', 'NDCG@20': '0.001295'}
Validation score increased.  Saving model ...
Model Training
rec dataset length: 43
  0%|                                                                                                                                                                                                       | 0/43 [00:10<?, ?it/s]

 35%|██████████████████████████████████████████████████████████████████▎                                                                                                                           | 15/43 [00:03<00:06,  4.25it/s][34m[1mwandb[39m[22m: [33mWARNING[39m (User provided step: 1 is less than current step: 9. Dropping entry: {'NMI_cluster_reassignment': 0.0, '_timestamp': 1714899853.2967246}).


 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 38/43 [00:09<00:01,  3.67it/s]
{'epoch': 9, 'rec_avg_loss': '1.94164', 'NMI_cluster_reassignment': '0.000000'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:10<00:00,  4.08it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]




[34m[1mwandb[39m[22m: [33mWARNING[39m (User provided step: 1 is less than current step: 10. Dropping entry: {'NMI_cluster_reassignment': 0.0, '_timestamp': 1714899874.2817106}).█████████████████████████████████████████| 43/43 [00:07<00:00,  5.18it/s]
{'Epoch': 9, 'HIT@5': '0.001363', 'NDCG@5': '0.001105', 'HIT@10': '0.001862', 'NDCG@10': '0.001261', 'HIT@15': '0.002362', 'NDCG@15': '0.001398', 'HIT@20': '0.002952', 'NDCG@20': '0.001535'}
Validation score increased.  Saving model ...
[Train] Preparing Clustering:
  0%|                                                                                                                                                                                                       | 0/43 [00:10<?, ?it/s]
  5%|████████▉                                                                                                                                                                                      | 2/43 [00:00<00:02, 18.99it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:01<00:00, 22.22it/s]
  0%|                                                                                                                                                                                                        | 0/1 [00:00<?, ?it/s]
Model Training
rec dataset length: 43
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:04<00:00,  4.66s/it]




 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋             | 40/43 [00:09<00:00,  4.04it/s]
{'epoch': 10, 'rec_avg_loss': '1.78334', 'NMI_cluster_reassignment': '0.425394'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:10<00:00,  4.29it/s]
 77%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                            | 33/43 [00:01<00:00, 24.26it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:01<00:00, 22.41it/s]
  0%|                                                                                                                                                                                                        | 0/1 [00:00<?, ?it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:04<00:00,  4.61s/it]

 51%|█████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                            | 22/43 [00:04<00:03,  5.35it/s][34m[1mwandb[39m[22m: [33mWARNING[39m (User provided step: 2 is less than current step: 11. Dropping entry: {'NMI_cluster_reassignment': 0.425393670797348, '_timestamp': 1714899901.4250264}).


100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:08<00:00,  5.33it/s]
{'Epoch': 10, 'HIT@5': '0.001363', 'NDCG@5': '0.001217', 'HIT@10': '0.001771', 'NDCG@10': '0.001341', 'HIT@15': '0.002453', 'NDCG@15': '0.001520', 'HIT@20': '0.003225', 'NDCG@20': '0.001702'}
Validation score increased.  Saving model ...
Model Training
rec dataset length: 43
Performing Rec model Training (UPTRec):




 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                               | 36/43 [00:08<00:01,  4.19it/s]
{'epoch': 11, 'rec_avg_loss': '1.67075', 'NMI_cluster_reassignment': '0.000000'}
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 43/43 [00:10<00:00,  4.25it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]




  0%|                                                                                                                                                                                                       | 0/43 [00:10<?, ?it/s]
  0%|                                                                                                                                                                                                       | 0/43 [00:00<?, ?it/s]
{'Epoch': 11, 'HIT@5': '0.001453', 'NDCG@5': '0.001321', 'HIT@10': '0.002226', 'NDCG@10': '0.001573', 'HIT@15': '0.003543', 'NDCG@15': '0.001917', 'HIT@20': '0.004224', 'NDCG@20': '0.002078'}
Validation score increased.  Saving model ...
Model Training
rec dataset length: 43

 35%|██████████████████████████████████████████████████████████████████▎                                                                                                                           | 15/43 [00:03<00:06,  4.20it/s][34m[1mwandb[39m[22m: [33mWARNING[39m (User provided step: 2 is less than current step: 12. Dropping entry: {'NMI_cluster_reassignment': 0.0, '_timestamp': 1714899928.592642}).

 67%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                             | 29/43 [00:06<00:03,  4.19it/s]
Traceback (most recent call last):
  File "main.py", line 269, in <module>
    main()
  File "main.py", line 234, in main
    trainer.train(epoch)
  File "/home/seongbeom/paper/preference_rec/trainers.py", line 99, in train
    self.iteration(epoch, self.train_dataloader, self.cluster_dataloader)
  File "/home/seongbeom/paper/preference_rec/trainers.py", line 404, in iteration
    for i, (rec_batch, cl_batches, seq_class_label_batches) in rec_cf_data_iter:
  File "/home/seongbeom/anaconda3/envs/recsys/lib/python3.8/site-packages/tqdm/std.py", line 1181, in __iter__
    for obj in iterable:
  File "/home/seongbeom/anaconda3/envs/recsys/lib/python3.8/site-packages/torch/utils/data/dataloader.py", line 631, in __next__
    data = self._next_data()
  File "/home/seongbeom/anaconda3/envs/recsys/lib/python3.8/site-packages/torch/utils/data/dataloader.py", line 675, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
  File "/home/seongbeom/anaconda3/envs/recsys/lib/python3.8/site-packages/torch/utils/data/_utils/fetch.py", line 51, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/home/seongbeom/anaconda3/envs/recsys/lib/python3.8/site-packages/torch/utils/data/_utils/fetch.py", line 51, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/home/seongbeom/paper/preference_rec/datasets.py", line 137, in __getitem__
    cur_rec_tensors = self._data_sample_rec_task(user_id, items, input_ids, target_pos, answer)
  File "/home/seongbeom/paper/preference_rec/datasets.py", line 88, in _data_sample_rec_task
    torch.tensor(target_pos, dtype=torch.long),
KeyboardInterrupt